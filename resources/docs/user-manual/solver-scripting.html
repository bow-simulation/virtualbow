<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Scripting - VirtualBow User Manual</title>
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <!-- MathJax -->
        <script async type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="introduction.html">Introduction</a></li><li class="chapter-item expanded "><a href="model-editor.html"><strong aria-hidden="true">1.</strong> Model Editor</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="model-editor-comments.html"><strong aria-hidden="true">1.1.</strong> Comments</a></li><li class="chapter-item expanded "><a href="model-editor-settings.html"><strong aria-hidden="true">1.2.</strong> Settings</a></li><li class="chapter-item expanded "><a href="model-editor-dimensions.html"><strong aria-hidden="true">1.3.</strong> Dimensions</a></li><li class="chapter-item expanded "><a href="model-editor-materials.html"><strong aria-hidden="true">1.4.</strong> Materials</a></li><li class="chapter-item expanded "><a href="model-editor-layers.html"><strong aria-hidden="true">1.5.</strong> Layers</a></li><li class="chapter-item expanded "><a href="model-editor-profile.html"><strong aria-hidden="true">1.6.</strong> Profile</a></li><li class="chapter-item expanded "><a href="model-editor-width.html"><strong aria-hidden="true">1.7.</strong> Width</a></li><li class="chapter-item expanded "><a href="model-editor-string.html"><strong aria-hidden="true">1.8.</strong> String</a></li><li class="chapter-item expanded "><a href="model-editor-masses.html"><strong aria-hidden="true">1.9.</strong> Masses</a></li><li class="chapter-item expanded "><a href="model-editor-damping.html"><strong aria-hidden="true">1.10.</strong> Damping</a></li></ol></li><li class="chapter-item expanded "><a href="result-viewer.html"><strong aria-hidden="true">2.</strong> Result Viewer</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="result-viewer-characteristics.html"><strong aria-hidden="true">2.1.</strong> Characteristics</a></li><li class="chapter-item expanded "><a href="result-viewer-shape.html"><strong aria-hidden="true">2.2.</strong> Shape</a></li><li class="chapter-item expanded "><a href="result-viewer-stress.html"><strong aria-hidden="true">2.3.</strong> Stress</a></li><li class="chapter-item expanded "><a href="result-viewer-curvature.html"><strong aria-hidden="true">2.4.</strong> Curvature</a></li><li class="chapter-item expanded "><a href="result-viewer-energy.html"><strong aria-hidden="true">2.5.</strong> Energy</a></li><li class="chapter-item expanded "><a href="result-viewer-others.html"><strong aria-hidden="true">2.6.</strong> Other Plots</a></li></ol></li><li class="chapter-item expanded "><a href="solver.html"><strong aria-hidden="true">3.</strong> Solver</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="solver-command-line.html"><strong aria-hidden="true">3.1.</strong> Command Line</a></li><li class="chapter-item expanded "><a href="solver-file-formats.html"><strong aria-hidden="true">3.2.</strong> File Formats</a></li><li class="chapter-item expanded "><a href="solver-scripting.html" class="active"><strong aria-hidden="true">3.3.</strong> Scripting</a></li></ol></li><li class="chapter-item expanded "><a href="appendix.html"><strong aria-hidden="true">4.</strong> Appendix</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="appendix-model-files.html"><strong aria-hidden="true">4.1.</strong> A - Model Files</a></li><li class="chapter-item expanded "><a href="appendix-result-files.html"><strong aria-hidden="true">4.2.</strong> B - Result Files</a></li><li class="chapter-item expanded "><a href="appendix-bending-test.html"><strong aria-hidden="true">4.3.</strong> C - Bending Test</a></li><li class="chapter-item expanded "><a href="appendix-tips-and-tricks.html"><strong aria-hidden="true">4.4.</strong> D - Tips & Tricks</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">VirtualBow User Manual</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="scripting"><a class="header" href="#scripting">Scripting</a></h1>
<p>The main use of the solver as a standalone application is the ability to write programs that automatically launch simulations and analyze the results.
This is especially useful for performing design optimizations or exploring the influence of certain model parameters on the simulation results.</p>
<p>Scripts that interoperate with VirtualBow have to be able to call the solver via the command line interface as well as read and write the model and result files that constitute the input and output of the solver.
As a consequence of the file formats, any programming language that supports JSON and MessagePack can be used.
Both are fairly common formats and most languages have either built-in support or there are external libraries available.</p>
<p>For getting started, the following sections show how to interface with VirtualBow for some programming languages commonly used in scientific computing.
Each of the examples performs the same series of basic tasks:</p>
<ol>
<li>Load, modify and save a model file</li>
<li>Run a static simulation with the model file</li>
<li>Load the result file and evaluate the maximum stress of the first layer at full draw</li>
</ol>
<h2 id="python"><a class="header" href="#python">Python</a></h2>
<p>The python example below uses two external packages, <a href="https://pypi.org/project/msgpack/">msgpack</a> for reading the result files and <a href="https://pypi.org/project/numpy/">numpy</a> for evaluating the stresses.
They can be installed with <code>pip install msgpack numpy</code>.</p>
<pre><code class="language-python">import json, msgpack      # Loading and saving model and result files
import numpy as np        # Evaluating stresses
import subprocess         # Runnig the simulation

# Load model file
with open(&quot;input.bow&quot;, &quot;r&quot;) as file:
    input = json.load(file)

# Modify model data
input[&quot;string&quot;][&quot;n_strands&quot;] += 1

# Save model file
with open(&quot;input.bow&quot;, &quot;w&quot;) as file:
    json.dump(input, file, indent=2)

# Run a static simulation
subprocess.call([&quot;virtualbow-slv&quot;, &quot;--static&quot;, &quot;input.bow&quot;, &quot;output.res&quot;])

# Load the result file
with open(&quot;output.res&quot;, &quot;rb&quot;) as file:
    output = msgpack.unpack(file, raw=False)

# Evaluate stresses
He_back = np.array(output[&quot;setup&quot;][&quot;limb_properties&quot;][&quot;layers&quot;][0][&quot;He_back&quot;])
Hk_back = np.array(output[&quot;setup&quot;][&quot;limb_properties&quot;][&quot;layers&quot;][0][&quot;Hk_back&quot;])

epsilon = np.array(output[&quot;statics&quot;][&quot;states&quot;][&quot;epsilon&quot;][-1])
kappa   = np.array(output[&quot;statics&quot;][&quot;states&quot;][&quot;kappa&quot;][-1])
sigma = He_back.dot(epsilon) + Hk_back.dot(kappa)

print(sigma.max())
</code></pre>
<h2 id="matlab"><a class="header" href="#matlab">Matlab</a></h2>
<p>This Matlab example uses the <a href="https://de.mathworks.com/matlabcentral/fileexchange/33381">JSONLab</a> library, which can read and write both JSON and MessagePack files.</p>
<pre><code class="language-matlab">% Load model file
input = loadjson('input.bow');

% Modify model data
input.string.n_strands = input.string.n_strands + 1;

% Save model file
savejson('', input, 'input.bow');

% Run a static simulation
system('virtualbow-slv --static input.bow output.res');

% Load the result file
output = loadmsgpack('output.res');

% Evaluate stresses
He_back = output.setup.limb_properties.layers{1}.He_back;
Hk_back = output.setup.limb_properties.layers{1}.Hk_back;

epsilon = output.statics.states.epsilon(:,end);
kappa   = output.statics.states.kappa(:,end);
sigma = He_back*epsilon + Hk_back*kappa;

disp(max(sigma));
</code></pre>
<h2 id="julia"><a class="header" href="#julia">Julia</a></h2>
<p>For the Julia example, two external packages are used: <a href="https://juliahub.com/ui/Packages/JSON/uf6oy">JSON</a> for loading model files and <a href="https://juliahub.com/ui/Packages/MsgPack/oDgLV">MsgPack</a> for loading result files.
They can be installed with <code>julia&gt; import Pkg; Pkg.add(&quot;JSON&quot;); Pkg.add(&quot;MsgPack&quot;)</code>.</p>
<pre><code class="language-julia">using JSON        # Loading and saving model files
using MsgPack     # Loading result files

# Load model file
stream = open(&quot;input.bow&quot;, &quot;r&quot;)
input = JSON.parse(stream)
close(stream)

# Modify model data
input[&quot;string&quot;][&quot;n_strands&quot;] += 1

# Save model file
stream = open(&quot;input.bow&quot;, &quot;w&quot;)
JSON.print(stream, input, 2)
close(stream)

# Run a static simulation
run(`virtualbow-slv --static input.bow output.res`)

# Load the result file
stream = open(&quot;output.res&quot;, &quot;r&quot;)
output = unpack(stream)
close(stream)

# Evaluate stresses
He_back = hcat(output[&quot;setup&quot;][&quot;limb_properties&quot;][&quot;layers&quot;][1][&quot;He_back&quot;]... )
Hk_back = hcat(output[&quot;setup&quot;][&quot;limb_properties&quot;][&quot;layers&quot;][1][&quot;Hk_back&quot;]... )

epsilon = output[&quot;statics&quot;][&quot;states&quot;][&quot;epsilon&quot;][end]
kappa   = output[&quot;statics&quot;][&quot;states&quot;][&quot;kappa&quot;][end]
sigma = He_back*epsilon + Hk_back*kappa

println(max(sigma...))
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="solver-file-formats.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                            <a rel="next" href="appendix.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="solver-file-formats.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                    <a rel="next" href="appendix.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
    </body>
</html>
